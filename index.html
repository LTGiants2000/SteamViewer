<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Newest Steam Game Previews</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0 30px;
      background: #f4f4f4;
      color: #222;
    }

    h1 {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 10px;
    }

    .game-section {
      margin-bottom: 40px;
    }

    .game-section h2 {
      margin: 10px 0;
      font-size: 1.5rem;
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }

    .scroll-row {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding: 10px 0;
    }

    .scroll-row::-webkit-scrollbar {
      height: 8px;
    }

    .scroll-row::-webkit-scrollbar-thumb {
      background-color: #aaa;
      border-radius: 4px;
    }

    img {
      max-height: 180px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s ease-in-out;
    }

    img:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h1>Newest Steam Game Previews</h1>
  <div id="game-container"></div>

  <script>
    const grid = document.getElementById('game-container');

    fetch('/api/steamspy')
      .then(res => res.json())
      .then(allGames => {
        const sorted = Object.values(allGames)
          .filter(g => g.positive > 0 && g.owners !== '0 .. 0')
          .sort((a, b) => b.release_date - a.release_date)
          .slice(0, 10); // Top 10 newest

        sorted.forEach(game => fetchAndDisplayGame(game.appid, game.name));
      })
      .catch(err => {
        console.error("Failed to load game list:", err);
      });

    function fetchAndDisplayGame(appId, gameName) {
      fetch(`/api/game/${appId}`)
        .then(res => res.json())
        .then(data => {
          if (!data[appId]?.success) return;
          const gameData = data[appId].data;

          const section = document.createElement('div');
          section.className = 'game-section';

          const title = document.createElement('h2');
          title.textContent = gameName;
          section.appendChild(title);

          const screenshots = gameData.screenshots;
          const scroller = document.createElement('div');
          scroller.className = 'scroll-row';

          screenshots.forEach(ss => {
            const img = document.createElement('img');
            img.src = ss.path_full;
            scroller.appendChild(img);
          });

          section.appendChild(scroller);
          grid.appendChild(section);
        })
        .catch(err => console.error(`Failed to load screenshots for ${gameName}`, err));
    }
  </script>
</body>
</html>
